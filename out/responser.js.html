<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: responser.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: responser.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @summary it is used for the paging purposes using offset
 * @returns {PageObject}
 * @exmaple an object that has the properties {
 *   "modleNmae": {
 *       "total": 0,
 *       "items": [],
 *       "limit": 0,
 *       "offset": 0,
 *       "next": "",
 *       "previous": null,
 *       "href": ""
 *   }
 *}
 *@param {Array} items this is the array on witch you are providing the pagination
 *@param {Array} modelName the name of the page
 *@param {Request} req this is an express request object
 *@param {Number} limit the number of items that the user wants to get returned
 *@param {Number} offset the number of items to skip from the begining
 */
module.exports.getPaging = (
  items,
  modelName,
  req,
  limit = null,
  offset = null
) => {
  if (limit == null) {
    if (!req.query.limit) limit = 20;
    else limit = req.query.limit;
  }

  if (offset == null) {
    if (!req.query.offset) offset = 20;
    else offset = req.query.offset;
  }

  let linkSpec = getLinkSPec(req, limit, offset);
  return getPaging(
    items,
    modelName,
    linkSpec.limit,
    linkSpec.offset,
    linkSpec.next,
    linkSpec.previous,
    linkSpec.href
  );
};

// TODO: 1. modify teh get Paging to cancell the linkSpec function
// TODO: 1. modify the getPaging and handle next = null in case there is nothing left to explore
const getPaging = (
  items,
  modelName,
  limit = null,
  offset = null,
  next = null,
  previous = null,
  href = null
) => {
  if (items.length &lt; limit) {
    next = null;
  }
  let page = {};
  page[modelName] = {
    total: items.length,
    items,
    limit,
    offset,
    next,
    previous,
    href
  };
  return page;
};

const getLinkSPec = (req, limit, offset) => {
  let LOCAL_HOST = `${req.protocol}://${req.get('host')}`;
  console.log(req.originalUrl);
  let originalUrl = req.originalUrl;
  if (originalUrl.includes('?')) {
    let index = originalUrl.indexOf('?');
    originalUrl = originalUrl.substring(0, index);
  }
  let href = LOCAL_HOST + originalUrl;
  let nnext = `${href}?offset=${offset + limit}&amp;limit=${limit}`;
  let preOffset = offset - limit;
  if (preOffset &lt; 0) {
    preOffset = 0;
  }
  let previous = `${href}?offset=${preOffset}&amp;limit=${limit}`;
  if (preOffset == offset) {
    previous = null;
  }
  return {
    href,
    next: nnext,
    previous,
    limit,
    offset
  };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#getPaging">getPaging</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Thu Apr 16 2020 06:48:21 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
